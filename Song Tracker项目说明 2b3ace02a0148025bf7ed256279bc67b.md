# Song Trackeré¡¹ç›®è¯´æ˜

## ğŸ“š æ–‡æ¡£è¯´æ˜

**ä¿ç•™å¼€å‘**ï¼šå¸Œæœ›å¿«é€ŸæŒæ¡å…¨æ ˆå¼€å‘ï¼Œèƒ½å¤Ÿç‹¬ç«‹å¼€å‘ç±»ä¼¼é¡¹ç›®çš„å¼€å‘è€…
**æŠ€æœ¯æ ˆ**ï¼šNext.js 16 + TypeScript + Supabase + Tailwind CSS + Shadcn/ui
**é€‚ç”¨åœºæ™¯**ï¼šSaaS åº”ç”¨ã€æ•°æ®è¿½è¸ªç³»ç»Ÿã€å¤šç”¨æˆ·ç®¡ç†å¹³å°

# ç¬¬ä¸€éƒ¨åˆ†ï¼šé¡¹ç›®æ¦‚è§ˆ

## 1.1 ç³»ç»Ÿæ¶æ„å›¾

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æµè§ˆå™¨                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç™»å½•/æ³¨å†Œ   â”‚  â”‚  æ­Œæ›²ç®¡ç†    â”‚  â”‚  æ•°æ®å¯è§†åŒ–  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Vercel (Next.js æ‰˜ç®¡)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å‰ç«¯è·¯ç”±å±‚ (App Router)                          â”‚  â”‚
â”‚  â”‚  /login â†’ ç™»å½•é¡µ                                  â”‚  â”‚
â”‚  â”‚  /dashboard â†’ ä»ªè¡¨ç›˜                              â”‚  â”‚
â”‚  â”‚  /dashboard/songs/[id] â†’ è¯¦æƒ…é¡µ                  â”‚  â”‚
â”‚  â”‚  /admin â†’ ç®¡ç†åå°                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API è·¯ç”±å±‚ (/app/api/*)                          â”‚  â”‚
â”‚  â”‚  /api/songs/add â†’ æ·»åŠ æ­Œæ›²                        â”‚  â”‚
â”‚  â”‚  /api/songs/my-songs â†’ è·å–ç”¨æˆ·æ­Œæ›²              â”‚  â”‚
â”‚  â”‚  /api/admin/* â†’ ç®¡ç†å‘˜ API                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Supabase å¹³å°                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Auth è®¤è¯    â”‚  â”‚ PostgreSQL   â”‚  â”‚ pg_cron      â”‚  â”‚
â”‚  â”‚ - æ³¨å†Œç™»å½•   â”‚  â”‚ - 6å¼ æ•°æ®è¡¨  â”‚  â”‚ - å®šæ—¶æŠ“å–   â”‚  â”‚
â”‚  â”‚ - Session    â”‚  â”‚ - RLS ç­–ç•¥   â”‚  â”‚ - æ¯æ—¥æ±‡æ€»   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æŠ–éŸ³éŸ³ä¹ API (å¤–éƒ¨æ•°æ®æº)                   â”‚
â”‚  [https://beta-luna.douyin.com/luna/h5/seo_track](https://beta-luna.douyin.com/luna/h5/seo_track)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

## 1.2 æŠ€æœ¯æ ˆè¯¦è§£

### å‰ç«¯æ¡†æ¶

- **Next.js 16 (App Router)**ï¼šæœåŠ¡ç«¯æ¸²æŸ“ + è·¯ç”±
- **React 18**ï¼šUI ç»„ä»¶åº“
- **TypeScript**ï¼šç±»å‹å®‰å…¨

### UI ç›¸å…³

- **Tailwind CSS**ï¼šåŸå­åŒ– CSS æ¡†æ¶
- **Shadcn/ui**ï¼šåŸºäº Radix UI çš„ç»„ä»¶åº“
- **Recharts**ï¼šå›¾è¡¨åº“
- **Lucide React**ï¼šå›¾æ ‡åº“

### åç«¯æœåŠ¡

- **Supabase**ï¼š
    - PostgreSQL æ•°æ®åº“
    - Authenticationï¼ˆç”¨æˆ·è®¤è¯ï¼‰
    - Row Level Securityï¼ˆæ•°æ®æƒé™ï¼‰
    - pg_cronï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰

### çŠ¶æ€ç®¡ç†

- **Zustand**ï¼šè½»é‡çº§çŠ¶æ€ç®¡ç†

### éƒ¨ç½²

- **Vercel**ï¼šå‰ç«¯æ‰˜ç®¡
- **Supabase Cloud**ï¼šåç«¯æœåŠ¡

## 1.3 æ ¸å¿ƒåŠŸèƒ½åˆ—è¡¨

### ç”¨æˆ·åŠŸèƒ½

1. âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
2. âœ… æ·»åŠ æ­Œæ›²è¿½è¸ª
3. âœ… æŸ¥çœ‹æ­Œæ›²åˆ—è¡¨
4. âœ… æŸ¥çœ‹æ­Œæ›²è¯¦æƒ…ï¼ˆå›¾è¡¨ï¼‰
5. âœ… å–æ¶ˆè¿½è¸ª
6. âœ… ä¿®æ”¹è¿½è¸ªé¢‘ç‡ï¼ˆRankï¼‰

### æ•°æ®åŠŸèƒ½

1. âœ… è‡ªåŠ¨å®šæ—¶æŠ“å–æ•°æ®
2. âœ… æ¯æ—¥å¢é‡è®¡ç®—
3. âœ… è¶‹åŠ¿å›¾è¡¨å±•ç¤º
4. âœ… ç»Ÿè®¡å¡ç‰‡å±•ç¤º

### ç®¡ç†åŠŸèƒ½

1. âœ… ç®¡ç†å‘˜æƒé™æ§åˆ¶
2. âœ… ç”¨æˆ·ç®¡ç†
3. âœ… æ­Œæ›²ç®¡ç†
4. âœ… æ‰‹åŠ¨è§¦å‘æŠ“å–
5. âœ… æŸ¥çœ‹æŠ“å–æ—¥å¿—

## 1.4 æ•°æ®æµå‘å›¾

### 1.4.1 ç”¨æˆ·æ·»åŠ æ­Œæ›²æµç¨‹

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥ â”‚
â”‚ æ­Œæ›² ID  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AddSongForm ç»„ä»¶   â”‚
â”‚ 1. éªŒè¯è¾“å…¥        â”‚
â”‚ 2. è°ƒç”¨ API        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/douyin/fetch-trackâ”‚
â”‚ 1. è°ƒç”¨æŠ–éŸ³ API        â”‚
â”‚ 2. è§£æ JSON æ•°æ®      â”‚
â”‚ 3. è¿”å›æ­Œæ›²ä¿¡æ¯        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯å±•ç¤ºé¢„è§ˆ           â”‚
â”‚ - æ­Œæ›²å               â”‚
â”‚ - æ­Œæ‰‹                 â”‚
â”‚ - ç»Ÿè®¡æ•°æ®             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ç”¨æˆ·ç¡®è®¤
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/songs/add         â”‚
â”‚ 1. æ£€æŸ¥æ­Œæ›²æ˜¯å¦å­˜åœ¨    â”‚
â”‚ 2. ä¿å­˜åˆ° songs è¡¨     â”‚
â”‚ 3. ä¿å­˜åˆå§‹ç»Ÿè®¡        â”‚
â”‚ 4. åˆ›å»ºç”¨æˆ·å…³è”        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase æ•°æ®åº“        â”‚
â”‚ - songs                â”‚
â”‚ - song_stats           â”‚
â”‚ - user_song_relations  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1.4.2 å®šæ—¶æ•°æ®æŠ“å–æµç¨‹

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase pg_cron    â”‚
â”‚ æ¯å°æ—¶è§¦å‘          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ trigger_fetch_rank_a()   â”‚
â”‚ SQL å‡½æ•°                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŸ¥è¯¢ Rank A æ­Œæ›²         â”‚
â”‚ SELECT * FROM songs      â”‚
â”‚ WHERE rank = 'A'         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¾ªç¯æ¯é¦–æ­Œæ›²             â”‚
â”‚ 1. è°ƒç”¨æŠ–éŸ³ API          â”‚
â”‚ 2. è§£ææ•°æ®              â”‚
â”‚ 3. ä¿å­˜åˆ° song_stats     â”‚
â”‚ 4. è®°å½•æ—¥å¿—              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®åº“æ›´æ–°               â”‚
â”‚ - song_stats (æ–°è®°å½•)    â”‚
â”‚ - fetch_logs (æ—¥å¿—)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# ç¬¬äºŒéƒ¨åˆ†ï¼šç›®å½•ç»“æ„è¯¦è§£

## 2.1 å®Œæ•´ç›®å½•æ ‘

song-tracker/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/                   # è®¤è¯ç›¸å…³è·¯ç”±ç»„
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx         # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ actions.ts           # Server Actions (ç™»å½•/æ³¨å†Œ/ç™»å‡º)
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx           # è®¤è¯å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ dashboard/               # ä¸»åº”ç”¨è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ songs/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx     # æ­Œæ›²è¯¦æƒ…é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx             # ä»ªè¡¨ç›˜ä¸»é¡µ
â”‚   â”‚   â”œâ”€â”€ admin/                   # ç®¡ç†åå°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx             # ç®¡ç†åå°ä¸»é¡µ
â”‚   â”‚   â”œâ”€â”€ api/                     # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ songs/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ add/route.ts    # æ·»åŠ æ­Œæ›²
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ my-songs/route.ts # è·å–ç”¨æˆ·æ­Œæ›²
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ untrack/route.ts  # å–æ¶ˆè¿½è¸ª
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ update-rank/route.ts # ä¿®æ”¹ Rank
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/route.ts   # è·å–æ­Œæ›²è¯¦æƒ…
â”‚   â”‚   â”‚   â”œâ”€â”€ douyin/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ fetch-track/route.ts # è°ƒç”¨æŠ–éŸ³ API
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ users/route.ts  # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ all-songs/route.ts # å…¨å±€æ­Œæ›²
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ trigger-fetch/route.ts # æ‰‹åŠ¨æŠ“å–
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ trigger-daily-rollup/route.ts # æ¯æ—¥æ±‡æ€»
â”‚   â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚   â”‚       â””â”€â”€ is-admin/route.ts # æ£€æŸ¥ç®¡ç†å‘˜
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ callback/route.ts    # è®¤è¯å›è°ƒ
â”‚   â”‚   â”œâ”€â”€ test-db/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx             # æ•°æ®åº“æµ‹è¯•é¡µ
â”‚   â”‚   â”œâ”€â”€ layout.tsx               # æ ¹å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx                 # é¦–é¡µï¼ˆé‡å®šå‘ï¼‰
â”‚   â”‚   â””â”€â”€ globals.css              # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ components/                  # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â””â”€â”€ trigger-fetch.tsx   # æ‰‹åŠ¨è§¦å‘ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ charts/
â”‚   â”‚   â”‚   â”œâ”€â”€ stats-chart.tsx     # è¶‹åŠ¿å›¾è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ daily-stats-chart.tsx # æ¯æ—¥å¢é‡å›¾
â”‚   â”‚   â”‚   â””â”€â”€ stat-cards.tsx      # ç»Ÿè®¡å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”‚   â””â”€â”€ auth-provider.tsx   # è®¤è¯ä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ songs/
â”‚   â”‚   â”‚   â”œâ”€â”€ add-song-form.tsx   # æ·»åŠ æ­Œæ›²è¡¨å•
â”‚   â”‚   â”‚   â”œâ”€â”€ song-card.tsx       # æ­Œæ›²å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ song-list.tsx       # æ­Œæ›²åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ delete-song-dialog.tsx # åˆ é™¤ç¡®è®¤
â”‚   â”‚   â”‚   â””â”€â”€ update-rank-dialog.tsx # ä¿®æ”¹ Rank
â”‚   â”‚   â”œâ”€â”€ ui/                     # Shadcn UI ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ... (å…¶ä»–ç»„ä»¶)
â”‚   â”‚   â”œâ”€â”€ theme-provider.tsx      # ä¸»é¢˜æä¾›è€…
â”‚   â”‚   â””â”€â”€ theme-toggle.tsx        # ä¸»é¢˜åˆ‡æ¢
â”‚   â”œâ”€â”€ hooks/                      # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â””â”€â”€ use-fetch-song.ts      # è·å–æ­Œæ›²ä¿¡æ¯
â”‚   â”œâ”€â”€ lib/                        # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts          # å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts          # æœåŠ¡ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ middleware.ts      # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ admin.ts               # ç®¡ç†å‘˜å·¥å…·
â”‚   â”‚   â”œâ”€â”€ parse-douyin-data.ts   # æ•°æ®è§£æ
â”‚   â”‚   â””â”€â”€ utils.ts               # é€šç”¨å·¥å…·
â”‚   â”œâ”€â”€ store/                      # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ auth-store.ts          # è®¤è¯çŠ¶æ€
â”‚   â””â”€â”€ types/                      # TypeScript ç±»å‹
â”‚       â””â”€â”€ index.ts               # ç±»å‹å®šä¹‰
â”œâ”€â”€ supabase/                       # Supabase é…ç½®
â”‚   â””â”€â”€ migrations/                # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ workers/                        # Cloudflare Workers (å¯é€‰)
â”œâ”€â”€ .env.local                     # æœ¬åœ°ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production                # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ .gitignore
â”œâ”€â”€ next.config.js                 # Next.js é…ç½®
â”œâ”€â”€ package.json
â”œâ”€â”€ tailwind.config.ts             # Tailwind é…ç½®
â”œâ”€â”€ tsconfig.json                  # TypeScript é…ç½®
â””â”€â”€ [README.md](http://readme.md/)

## 2.2 ç›®å½•ä½œç”¨è¯´æ˜

### `src/app/` - Next.js App Router

è¿™æ˜¯ Next.js 15 çš„æ ¸å¿ƒï¼Œä½¿ç”¨**æ–‡ä»¶ç³»ç»Ÿè·¯ç”±**ï¼š

- **æ–‡ä»¶å¤¹ = è·¯ç”±æ®µ**ï¼š`app/dashboard` â†’ `/dashboard`
- **page.tsx = é¡µé¢**ï¼šå®šä¹‰è¯¥è·¯ç”±çš„ UI
- **layout.tsx = å¸ƒå±€**ï¼šå…±äº«çš„ UI åŒ…è£¹
- **route.ts = API**ï¼šAPI ç«¯ç‚¹
- **(folder) = è·¯ç”±ç»„**ï¼šä¸å½±å“ URLï¼Œåªç”¨äºç»„ç»‡

### `src/components/` - React ç»„ä»¶

æŒ‰**åŠŸèƒ½æ¨¡å—**ç»„ç»‡ï¼š

- `admin/` - ç®¡ç†å‘˜ä¸“ç”¨ç»„ä»¶
- `charts/` - å›¾è¡¨ç»„ä»¶
- `songs/` - æ­Œæ›²ç›¸å…³ç»„ä»¶
- `ui/` - é€šç”¨ UI ç»„ä»¶ï¼ˆShadcnï¼‰
- `providers/` - React Context æä¾›è€…

### `src/lib/` - å·¥å…·å‡½æ•°åº“

**æ ¸å¿ƒå·¥å…·**ï¼š

- `supabase/` - æ•°æ®åº“å®¢æˆ·ç«¯ï¼ˆåˆ†å®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼‰
- `parse-douyin-data.ts` - è§£æå¤–éƒ¨ API æ•°æ®
- `utils.ts` - é€šç”¨å·¥å…·ï¼ˆcn å‡½æ•°ç­‰ï¼‰

### `src/store/` - å…¨å±€çŠ¶æ€

ä½¿ç”¨ **Zustand** ç®¡ç†ï¼š

- è®¤è¯çŠ¶æ€ï¼ˆç”¨æˆ·ä¿¡æ¯ã€æ˜¯å¦ç®¡ç†å‘˜ï¼‰
- å…¨å±€åŠ è½½çŠ¶æ€
- å…¶ä»–è·¨ç»„ä»¶çŠ¶æ€

### `src/types/` - TypeScript ç±»å‹

**é›†ä¸­ç®¡ç†ç±»å‹å®šä¹‰**ï¼š

- æ•°æ®åº“è¡¨ç±»å‹
- API å“åº”ç±»å‹
- ç»„ä»¶ Props ç±»å‹

# ç¬¬ä¸‰éƒ¨åˆ†ï¼šåˆ†é˜¶æ®µå¼€å‘è¿‡ç¨‹

## é˜¶æ®µ 1ï¼šé¡¹ç›®åˆå§‹åŒ–

### ç›®æ ‡

æ­å»º Next.js é¡¹ç›®ï¼Œé…ç½® TypeScriptã€Tailwind CSSã€Shadcn/u

### åˆ›å»ºçš„æ–‡ä»¶

```
æ–‡ä»¶è·¯å¾„ä½œç”¨å…³é”®å†…å®¹package.jsoné¡¹ç›®ä¾èµ–Next.js, React, TypeScript, Tailwindnext.config.jsNext.js é…ç½®å›¾ç‰‡åŸŸåã€ç¯å¢ƒå˜é‡tailwind.config.tsTailwind é…ç½®ä¸»é¢˜ã€é¢œè‰²ã€æš—è‰²æ¨¡å¼src/app/layout.tsxæ ¹å¸ƒå±€HTML ç»“æ„ã€å­—ä½“ã€Providersrc/types/index.tsç±»å‹å®šä¹‰Song, SongStats, DailyStats ç­‰.env.localç¯å¢ƒå˜é‡Supabase URL, Keys
```

### æ ¸å¿ƒä»£ç ç¤ºä¾‹

**`src/types/index.ts`** - ç±»å‹å®šä¹‰çš„åŸºç¡€

```jsx
// å®šä¹‰ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®ç±»å‹
export type RankType = 'A' | 'B' | 'C';

export interface Song {
  id: string;              // UUID (æ•°æ®åº“ä¸»é”®)
  song_id: string;         // æŠ–éŸ³æ­Œæ›² ID (ä¸šåŠ¡ä¸»é”®)
  title: string;
  artist: string;
  album: string;
  cover_url?: string;
  rank: RankType;          // è¿½è¸ªé¢‘ç‡
  created_at: string;      // ISO æ—¶é—´æˆ³
}

export interface SongStats {
  id: number;
  song_id: string;         // å¤–é”®å…³è” Song
  likes: number;
  favorites: number;
  comments: number;
  shares: number;
  fetched_at: string;
}
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**

- `Song` æ˜¯ä¸»å®ä½“ï¼Œå­˜å‚¨æ­Œæ›²åŸºæœ¬ä¿¡æ¯
- `SongStats` æ˜¯æ—¶åºæ•°æ®ï¼ŒåŒä¸€é¦–æ­Œæœ‰å¤šæ¡ç»Ÿè®¡è®°å½•
- ä½¿ç”¨ `song_id` (UUID) å…³è”ï¼Œè€Œä¸æ˜¯ `song_id` (æŠ–éŸ³ID)ï¼Œå› ä¸º UUID æ˜¯æ•°æ®åº“ä¸»é”®

### æ£€æŸ¥ç‚¹

- [ ]  `npm run dev` å¯åŠ¨æˆåŠŸ
- [ ]  `http://localhost:3000` æ˜¾ç¤ºé»˜è®¤é¡µé¢
- [ ]  Tailwind æ ·å¼ç”Ÿæ•ˆ
- [ ]  TypeScript æ— æŠ¥é”™

## é˜¶æ®µ 2ï¼šSupabase é…ç½®

### ç›®æ ‡

åˆ›å»ºæ•°æ®åº“è¡¨ã€é…ç½® RLSã€è¿æ¥ Next.js

### æ•°æ®åº“è¡¨ç»“æ„

### **songsï¼ˆæ­Œæ›²ä¸»è¡¨ï¼‰**

```jsx
CREATE TABLE songs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  song_id TEXT UNIQUE NOT NULL,      -- æŠ–éŸ³æ­Œæ›²IDï¼ˆä¸šåŠ¡å”¯ä¸€é”®ï¼‰
  title TEXT NOT NULL,
  artist TEXT NOT NULL,
  album TEXT,
  cover_url TEXT,
  rank TEXT DEFAULT 'C',              -- A/B/C
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç´¢å¼•ï¼šæå‡æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_songs_rank ON songs(rank);
CREATE INDEX idx_songs_song_id ON songs(song_id);
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªIDï¼Ÿ**

- `id` (UUID): æ•°æ®åº“å†…éƒ¨ä¸»é”®ï¼Œå…¨å±€å”¯ä¸€
- `song_id` (TEXT): ä¸šåŠ¡é”®ï¼ˆæŠ–éŸ³IDï¼‰ï¼Œç”¨äºå¯¹æ¥å¤–éƒ¨ API

### **user_song_relationsï¼ˆç”¨æˆ·-æ­Œæ›²å…³è”è¡¨ï¼‰**

```jsx
CREATE TABLE user_song_relations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  song_id UUID REFERENCES songs(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, song_id)           -- é˜²æ­¢é‡å¤å…³æ³¨
);
```

**ä¸ºä»€ä¹ˆéœ€è¦å…³è”è¡¨ï¼Ÿ**

- å¤šå¯¹å¤šå…³ç³»ï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥è¿½è¸ªå¤šé¦–æ­Œï¼Œä¸€é¦–æ­Œå¯ä»¥è¢«å¤šä¸ªç”¨æˆ·è¿½è¸ª
- çº§è”åˆ é™¤ï¼šç”¨æˆ·åˆ é™¤æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å…¶å…³æ³¨å…³ç³»

### **song_statsï¼ˆç»Ÿè®¡æ•°æ®è¡¨ï¼‰**

```jsx
CREATE TABLE song_stats (
  id BIGSERIAL PRIMARY KEY,           -- è‡ªå¢IDï¼ˆæ—¶åºæ•°æ®ï¼‰
  song_id UUID REFERENCES songs(id) ON DELETE CASCADE,
  likes BIGINT DEFAULT 0,
  favorites BIGINT DEFAULT 0,
  comments BIGINT DEFAULT 0,
  shares BIGINT DEFAULT 0,
  fetched_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç»„åˆç´¢å¼•ï¼šæŒ‰æ­Œæ›²å’Œæ—¶é—´æŸ¥è¯¢
CREATE INDEX idx_song_stats_song_fetched 
ON song_stats(song_id, fetched_at DESC);
```

**ä¸ºä»€ä¹ˆç”¨ BIGSERIALï¼Ÿ**

- æ—¶åºæ•°æ®é‡å¤§ï¼Œè‡ªå¢ ID æ€§èƒ½æ›´å¥½
- ä¸éœ€è¦ UUIDï¼ˆä¸æ˜¯ä¸šåŠ¡ä¸»é”®ï¼‰

### RLSï¼ˆRow Level Securityï¼‰ç­–ç•¥

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šRLS è®©æ•°æ®åº“è‡ªåŠ¨è¿‡æ»¤æ•°æ®ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®ã€‚

```jsx
-- å¯ç”¨ RLS
ALTER TABLE songs ENABLE ROW LEVEL SECURITY;

-- ç­–ç•¥ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±å…³æ³¨çš„æ­Œæ›²
CREATE POLICY "Users can view their tracked songs"
ON songs FOR SELECT
TO authenticated                      -- å·²ç™»å½•ç”¨æˆ·
USING (
  id IN (
    SELECT song_id 
    FROM user_song_relations 
    WHERE user_id = auth.uid()        -- å½“å‰ç”¨æˆ·ID
  )
  OR
  auth.uid() IN (SELECT user_id FROM admins) -- æˆ–æ˜¯ç®¡ç†å‘˜
);
```

**å·¥ä½œåŸç†**ï¼š

1. ç”¨æˆ·æŸ¥è¯¢ `SELECT * FROM songs`
2. PostgreSQL è‡ªåŠ¨æ·»åŠ  `WHERE` æ¡ä»¶
3. åªè¿”å›è¯¥ç”¨æˆ·æœ‰æƒé™çš„æ•°æ®

### Supabase å®¢æˆ·ç«¯é…ç½®

**`src/lib/supabase/client.ts`** - å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰

```jsx
import { createBrowserClient } from '@supabase/ssr'

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}
```

**`src/lib/supabase/server.ts`** - æœåŠ¡ç«¯ï¼ˆNext.js APIï¼‰

```jsx
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'

export async function createClient() {
  const cookieStore = await cookies()
  
  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) =>
            cookieStore.set(name, value, options)
          )
        },
      },
    }
  )
}
```

**ä¸ºä»€ä¹ˆåˆ†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Ÿ**
- **å®¢æˆ·ç«¯**ï¼šæµè§ˆå™¨ä¸­è¿è¡Œï¼Œä½¿ç”¨æµè§ˆå™¨ Cookie
- **æœåŠ¡ç«¯**ï¼šNext.js API Routesï¼Œéœ€è¦è¯»å–æœåŠ¡ç«¯ Cookie
- **SSR**ï¼šNext.js ä¸­é—´ä»¶ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†

### æ£€æŸ¥ç‚¹
- [ ] æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
- [ ] RLS ç­–ç•¥å¯ç”¨
- [ ] `/test-db` é¡µé¢è¿æ¥æˆåŠŸ

---

## é˜¶æ®µ 3ï¼šç”¨æˆ·è®¤è¯ç³»ç»Ÿ

### ç›®æ ‡
å®ç°æ³¨å†Œã€ç™»å½•ã€ç™»å‡ºï¼Œä¿æŠ¤è·¯ç”±

### è®¤è¯æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·å¡«å†™è¡¨å•â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Action    â”‚
â”‚ (login/signup)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Auth    â”‚
â”‚ - éªŒè¯å¯†ç        â”‚
â”‚ - ç”Ÿæˆ JWT       â”‚
â”‚ - è®¾ç½® Cookie    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ redirect()       â”‚
â”‚ â†’ /dashboard     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ–‡ä»¶

**`src/app/(auth)/actions.ts`** - Server Actions

```jsx
'use server'

import { redirect } from 'next/navigation'
import { createClient } from '@/lib/supabase/server'

// ç™»å½•
export async function login(formData: FormData) {
  const supabase = await createClient()
  
  const { error } = await supabase.auth.signInWithPassword({
    email: formData.get('email') as string,
    password: formData.get('password') as string,
  })
  
  if (error) {
    return { error: error.message }
  }
  
  redirect('/dashboard')
}

// æ³¨å†Œ
export async function signup(formData: FormData) {
  const supabase = await createClient()
  
  // å…ˆç™»å‡ºï¼ˆæ¸…é™¤æ—§ä¼šè¯ï¼‰
  await supabase.auth.signOut()
  
  const { error } = await supabase.auth.signUp({
    email: formData.get('email') as string,
    password: formData.get('password') as string,
  })
  
  if (error) {
    return { error: error.message }
  }
  
  redirect('/dashboard')
}

// ç™»å‡º
export async function logout() {
  const supabase = await createClient()
  await supabase.auth.signOut()
  redirect('/login')
}
```

**ä¸ºä»€ä¹ˆç”¨ Server Actionsï¼Ÿ**

- åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œæ›´å®‰å…¨
- ç›´æ¥è®¿é—®æ•°æ®åº“å’Œè®¤è¯ API
- è‡ªåŠ¨å¤„ç† Cookie
- æ”¯æŒ `redirect()`

**`src/store/auth-store.ts`** - å…¨å±€è®¤è¯çŠ¶æ€

```jsx
import { create } from 'zustand'
import { User } from '@supabase/supabase-js'

interface AuthState {
  user: User | null
  isAdmin: boolean
  isLoading: boolean
  setUser: (user: User | null) => void
  setIsAdmin: (isAdmin: boolean) => void
  setIsLoading: (isLoading: boolean) => void
  reset: () => void
}

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  isAdmin: false,
  isLoading: true,
  setUser: (user) => set({ user }),
  setIsAdmin: (isAdmin) => set({ isAdmin }),
  setIsLoading: (isLoading) => set({ isLoading }),
  reset: () => set({ user: null, isAdmin: false, isLoading: false }),
}))
```

**ä¸ºä»€ä¹ˆç”¨ Zustandï¼Ÿ**

- æ¯” Redux ç®€å•å¾ˆå¤š
- æ— éœ€ Context Provider
- TypeScript æ”¯æŒå¥½
- æ€§èƒ½ä¼˜ç§€

**`src/components/providers/auth-provider.tsx`** - è®¤è¯ç›‘å¬

```jsx
'use client'

import { useEffect } from 'react'
import { createClient } from '@/lib/supabase/client'
import { useAuthStore } from '@/store/auth-store'

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const { setUser, setIsAdmin, setIsLoading } = useAuthStore()
  
  useEffect(() => {
    const supabase = createClient()
    
    // è·å–åˆå§‹ session
    supabase.auth.getSession().then(({ data: { session } }) => {
      if (session?.user) {
        setUser(session.user)
        // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜
        checkAdmin(session.user.id)
      }
      setIsLoading(false)
    })
    
    // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (event, session) => {
        if (session?.user) {
          setUser(session.user)
          checkAdmin(session.user.id)
        } else {
          setUser(null)
          setIsAdmin(false)
        }
      }
    )
    
    return () => subscription.unsubscribe()
  }, [])
  
  const checkAdmin = async (userId: string) => {
    const response = await fetch('/api/auth/is-admin')
    const data = await response.json()
    setIsAdmin(data.isAdmin)
  }
  
  return <>{children}</>
}
```

**ä¸ºä»€ä¹ˆéœ€è¦ AuthProviderï¼Ÿ**

- åœ¨ App å¯åŠ¨æ—¶è·å–ç”¨æˆ·çŠ¶æ€
- ç›‘å¬è®¤è¯äº‹ä»¶ï¼ˆç™»å½•ã€ç™»å‡ºï¼‰
- æ›´æ–°å…¨å±€ store

### è·¯ç”±ä¿æŠ¤

**`src/app/dashboard/page.tsx`**

```jsx
'use client'

export default function DashboardPage() {
  const { user, isLoading } = useAuthStore()
  const router = useRouter()
  
  useEffect(() => {
    if (!isLoading && !user) {
      router.push('/login')  // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µ
    }
  }, [user, isLoading, router])
  
  if (isLoading) return <Loading />
  if (!user) return null
  
  return <div>Dashboard Content</div>
}
```

### æ£€æŸ¥ç‚¹

- [ ]  æ³¨å†Œæ–°ç”¨æˆ·æˆåŠŸ
- [ ]  ç™»å½•è·³è½¬åˆ° Dashboar

## é˜¶æ®µ 4ï¼šæ­Œæ›²æ·»åŠ ä¸æŠ–éŸ³ API é›†æˆ

### ç›®æ ‡

ç”¨æˆ·è¾“å…¥æ­Œæ›² IDï¼Œè°ƒç”¨æŠ–éŸ³ APIï¼Œè§£ææ•°æ®ï¼Œä¿å­˜åˆ°æ•°æ®åº“

### æ•°æ®æµç¨‹å›¾

```jsx
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·è¾“å…¥  â”‚
â”‚ æ­Œæ›² ID      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. useFetchSong Hook â”‚
â”‚ è°ƒç”¨å‰ç«¯ API         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. /api/douyin/fetch-track  â”‚
â”‚ - è°ƒç”¨æŠ–éŸ³ API              â”‚
â”‚ - è§£æ JSON                 â”‚
â”‚ - è¿”å›æ ‡å‡†åŒ–æ•°æ®            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å‰ç«¯æ˜¾ç¤ºé¢„è§ˆ      â”‚
â”‚ - æ­Œæ›²ä¿¡æ¯           â”‚
â”‚ - ç»Ÿè®¡æ•°æ®           â”‚
â”‚ - Rank é€‰æ‹©å™¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ç”¨æˆ·ç¡®è®¤
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. /api/songs/add       â”‚
â”‚ - æ£€æŸ¥æ­Œæ›²æ˜¯å¦å·²å­˜åœ¨    â”‚
â”‚ - æ’å…¥ songs è¡¨         â”‚
â”‚ - æ’å…¥ song_stats è¡¨    â”‚
â”‚ - åˆ›å»ºç”¨æˆ·å…³è”          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. åˆ·æ–°åˆ—è¡¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ–‡ä»¶è¯¦è§£

### **1. API è°ƒç”¨å±‚**

**`src/app/api/douyin/fetch-track/route.ts`**

```jsx
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url)
  const trackId = searchParams.get('track_id')
  
  if (!trackId) {
    return NextResponse.json({ error: 'ç¼ºå°‘æ­Œæ›² ID' }, { status: 400 })
  }
  
  try {
    // 1. è°ƒç”¨æŠ–éŸ³ API
    const apiUrl = `https://beta-luna.douyin.com/luna/h5/seo_track?track_id=${trackId}`
    const response = await fetch(apiUrl, {
      headers: {
        'User-Agent': 'Mozilla/5.0 ...',
        'Accept': 'application/json',
      },
      cache: 'no-store',  // ä¸ç¼“å­˜ï¼Œè·å–æœ€æ–°æ•°æ®
    })
    
    if (!response.ok) {
      throw new Error(`API è¿”å› ${response.status}`)
    }
    
    const data = await response.json()
    
    // 2. è¿”å›åŸå§‹æ•°æ®ï¼ˆè®©å‰ç«¯è§£æï¼‰
    return NextResponse.json(data)
    
  } catch (error) {
    return NextResponse.json(
      { error: 'è·å–å¤±è´¥' },
      { status: 500 }
    )
  }
}
```

**ä¸ºä»€ä¹ˆåœ¨æœåŠ¡ç«¯è°ƒç”¨ APIï¼Ÿ**

- é¿å… CORS è·¨åŸŸé—®é¢˜
- éšè— API ç»†èŠ‚
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- å¯ä»¥æ·»åŠ ç¼“å­˜ã€é™æµ

### **2. æ•°æ®è§£æå±‚**

**`src/lib/parse-douyin-data.ts`**

```jsx
import { ParsedSongInfo } from '@/types'

export function parseDouyinResponse(data: any, trackId: string): ParsedSongInfo | null {
  try {
    // æŠ–éŸ³ API è¿”å›çš„æ•°æ®ç»“æ„
    const seoTrack = data.seo_track
    
    if (!seoTrack) return null
    
    // æ ‡å‡†åŒ–æ•°æ®
    return {
      song_id: trackId,
      title: seoTrack.name || 'æœªçŸ¥æ­Œæ›²',
      artist: seoTrack.track?.artists?.[0]?.name || 'æœªçŸ¥æ­Œæ‰‹',
      album: seoTrack.track?.album?.name || 'æœªçŸ¥ä¸“è¾‘',
      cover_url: seoTrack.cover || '',
      // ç»Ÿè®¡æ•°æ®
      likes: parseInt(seoTrack.track?.stats?.count_collected || '0'),
      favorites: 0,  // API æ— æ­¤å­—æ®µ
      comments: parseInt(seoTrack.track?.stats?.count_comment || '0'),
      shares: parseInt(seoTrack.track?.stats?.count_shared || '0'),
    }
  } catch (error) {
    console.error('è§£æå¤±è´¥:', error)
    return null
  }
}

// æ ¼å¼åŒ–æ•°å­—ï¼ˆ1000 â†’ 1Kï¼‰
export function formatCount(count: number): string {
  if (count >= 1000000) {
    return `${(count / 1000000).toFixed(1)}M`
  }
  if (count >= 1000) {
    return `${(count / 1000).toFixed(1)}K`
  }
  return count.toString()
}
```

**ä¸ºä»€ä¹ˆéœ€è¦è§£æå±‚ï¼Ÿ**

- å¤–éƒ¨ API ç»“æ„å¤æ‚ï¼Œç»Ÿä¸€å¤„ç†
- æ•°æ®éªŒè¯å’Œå®¹é”™
- æ–¹ä¾¿é€‚é…å¤šä¸ªæ•°æ®æº
- ç±»å‹å®‰å…¨

### **3. è‡ªå®šä¹‰ Hook**

**`src/hooks/use-fetch-song.ts`**

```jsx
import { useState } from 'react'
import { ParsedSongInfo } from '@/types'
import { parseDouyinResponse, validateParsedSong } from '@/lib/parse-douyin-data'

export function useFetchSong() {
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  
  const fetchSong = async (trackId: string): Promise<ParsedSongInfo | null> => {
    setIsLoading(true)
    setError(null)
    
    try {
      // 1. è°ƒç”¨åç«¯ API
      const response = await fetch(`/api/douyin/fetch-track?track_id=${trackId}`)
      
      if (!response.ok) {
        throw new Error('è·å–å¤±è´¥')
      }
      
      const data = await response.json()
      
      // 2. è§£ææ•°æ®
      const parsed = parseDouyinResponse(data, trackId)
      
      // 3. éªŒè¯æ•°æ®
      if (!validateParsedSong(parsed)) {
        throw new Error('æ•°æ®æ— æ•ˆ')
      }
      
      return parsed
      
    } catch (err) {
      const message = err instanceof Error ? err.message : 'æœªçŸ¥é”™è¯¯'
      setError(message)
      return null
    } finally {
      setIsLoading(false)
    }
  }
  
  return { fetchSong, isLoading, error }
}
```

**ä¸ºä»€ä¹ˆç”¨è‡ªå®šä¹‰ Hookï¼Ÿ**

- å°è£…ä¸šåŠ¡é€»è¾‘
- ç®¡ç†çŠ¶æ€ï¼ˆloading, errorï¼‰
- å¯é‡ç”¨
- æµ‹è¯•å‹å¥½

### **4. æ·»åŠ æ­Œæ›²ç»„ä»¶**

**`src/components/songs/add-song-form.tsx`** - æ ¸å¿ƒç»„ä»¶

```jsx
'use client'

import { useState } from 'react'
import { useFetchSong } from '@/hooks/use-fetch-song'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'

export function AddSongForm({ onSuccess }: { onSuccess?: () => void }) {
  const [trackId, setTrackId] = useState('')
  const [selectedRank, setSelectedRank] = useState<'A' | 'B' | 'C'>('C')
  const [songPreview, setSongPreview] = useState<ParsedSongInfo | null>(null)
  const [step, setStep] = useState<'input' | 'preview' | 'success'>('input')
  
  const { fetchSong, isLoading, error } = useFetchSong()
  
  // æ­¥éª¤ 1: è·å–æ­Œæ›²é¢„è§ˆ
  const handleFetchPreview = async () => {
    const result = await fetchSong(trackId)
    if (result) {
      setSongPreview(result)
      setStep('preview')
    }
  }
  
  // æ­¥éª¤ 2: ç¡®è®¤æ·»åŠ 
  const handleConfirmAdd = async () => {
    try {
      const response = await fetch('/api/songs/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ...songPreview,
          rank: selectedRank,
        }),
      })
      
      if (!response.ok) throw new Error('æ·»åŠ å¤±è´¥')
      
      setStep('success')
      onSuccess?.()  // é€šçŸ¥çˆ¶ç»„ä»¶åˆ·æ–°åˆ—è¡¨
      
    } catch (error) {
      console.error(error)
    }
  }
  
  // æ ¹æ®æ­¥éª¤æ¸²æŸ“ä¸åŒ UI
  return (
    <Card>
      {step === 'input' && (
        <InputStep 
          trackId={trackId}
          setTrackId={setTrackId}
          onFetch={handleFetchPreview}
          isLoading={isLoading}
          error={error}
        />
      )}
      
      {step === 'preview' && songPreview && (
        <PreviewStep
          song={songPreview}
          rank={selectedRank}
          setRank={setSelectedRank}
          onConfirm={handleConfirmAdd}
          onCancel={() => setStep('input')}
        />
      )}
      
      {step === 'success' && (
        <SuccessStep onReset={() => setStep('input')} />
      )}
    </Card>
  )
}
```

**ç»„ä»¶è®¾è®¡è¦ç‚¹**ï¼š

- **å¤šæ­¥éª¤è¡¨å•**ï¼šinput â†’ preview â†’ success
- **çŠ¶æ€æå‡**ï¼šé€šè¿‡ `onSuccess` é€šçŸ¥çˆ¶ç»„ä»¶
- **å­ç»„ä»¶åˆ†ç¦»**ï¼šæ¯ä¸ªæ­¥éª¤ç‹¬ç«‹ç»„ä»¶ï¼Œä¾¿äºç»´æŠ¤

### **5. ä¿å­˜åˆ°æ•°æ®åº“**

**`src/app/api/songs/add/route.ts`**

```jsx
import { NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/server'
import { createClient as createAdminClient } from '@supabase/supabase-js'

export async function POST(request: Request) {
  try {
    // 1. éªŒè¯ç”¨æˆ·èº«ä»½
    const supabase = await createClient()
    const { data: { user } } = await supabase.auth.getUser()
    
    if (!user) {
      return NextResponse.json({ error: 'æœªç™»å½•' }, { status: 401 })
    }
    
    // 2. è§£æè¯·æ±‚ä½“
    const body = await request.json()
    const { song_id, title, artist, album, cover_url, rank, likes, comments, shares } = body
    
    // 3. ä½¿ç”¨ admin å®¢æˆ·ç«¯ï¼ˆç»•è¿‡ RLSï¼‰
    const supabaseAdmin = createAdminClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.SUPABASE_SERVICE_ROLE_KEY!
    )
    
    // 4. æ£€æŸ¥æ­Œæ›²æ˜¯å¦å·²å­˜åœ¨
    const { data: existingSong } = await supabaseAdmin
      .from('songs')
      .select('id')
      .eq('song_id', song_id)
      .maybeSingle()
    
    let songUuid: string
    
    if (existingSong) {
      // æ­Œæ›²å­˜åœ¨ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å…³æ³¨
      songUuid = existingSong.id
      
      const { data: relation } = await supabaseAdmin
        .from('user_song_relations')
        .select('id')
        .eq('user_id', user.id)
        .eq('song_id', songUuid)
        .maybeSingle()
      
      if (relation) {
        return NextResponse.json(
          { error: 'å·²æ·»åŠ è¿‡æ­¤æ­Œæ›²' },
          { status: 409 }
        )
      }
      
    } else {
      // 5. åˆ›å»ºæ–°æ­Œæ›²
      const { data: newSong, error: insertError } = await supabaseAdmin
        .from('songs')
        .insert({
          song_id,
          title,
          artist,
          album,
          cover_url,
          rank,
        })
        .select('id')
        .single()
      
      if (insertError) throw insertError
      
      songUuid = newSong.id
      
      // 6. ä¿å­˜åˆå§‹ç»Ÿè®¡æ•°æ®
      await supabaseAdmin
        .from('song_stats')
        .insert({
          song_id: songUuid,
          likes,
          favorites: 0,
          comments,
          shares,
        })
    }
    
    // 7. åˆ›å»ºç”¨æˆ·å…³è”
    await supabaseAdmin
      .from('user_song_relations')
      .insert({
        user_id: user.id,
        song_id: songUuid,
      })
    
    return NextResponse.json({
      success: true,
      song_id: songUuid,
    })
    
  } catch (error: any) {
    return NextResponse.json(
      { error: error.message },
      { status: 500 }
    )
  }
}
```

**å…³é”®é€»è¾‘**ï¼š
1. **éªŒè¯ç”¨æˆ·èº«ä»½**ï¼šå¿…é¡»ç™»å½•
2. **æ£€æŸ¥é‡å¤**ï¼šåŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤æ·»åŠ 
3. **äº‹åŠ¡å¤„ç†**ï¼š
   - æ’å…¥/è·å–æ­Œæ›²
   - æ’å…¥ç»Ÿè®¡æ•°æ®
   - åˆ›å»ºç”¨æˆ·å…³è”
4. **ä½¿ç”¨ Admin å®¢æˆ·ç«¯**ï¼šç»•è¿‡ RLSï¼Œç›´æ¥å†™å…¥

**ä¸ºä»€ä¹ˆç”¨ Admin å®¢æˆ·ç«¯ï¼Ÿ**
- RLS ç­–ç•¥é™åˆ¶äº†æ’å…¥æƒé™
- éœ€è¦ä»¥ç³»ç»Ÿèº«ä»½å†™å…¥æ•°æ®
- Service Role Key æœ‰å®Œå…¨æƒé™

### æ£€æŸ¥ç‚¹
- [ ] è¾“å…¥æ­Œæ›² IDï¼Œè·å–é¢„è§ˆ
- [ ] æ˜¾ç¤ºæ­Œæ›²ä¿¡æ¯å’Œç»Ÿè®¡
- [ ] ç‚¹å‡»ç¡®è®¤ï¼ŒæˆåŠŸæ·»åŠ 
- [ ] æ•°æ®åº“æœ‰æ–°è®°å½•
- [ ] åˆ—è¡¨åˆ·æ–°æ˜¾ç¤ºæ–°æ­Œæ›²

---

## é˜¶æ®µ 5ï¼šæ­Œæ›²åˆ—è¡¨ä¸ç®¡ç†

### ç›®æ ‡
æ˜¾ç¤ºç”¨æˆ·è¿½è¸ªçš„æ­Œæ›²ï¼Œæ”¯æŒå–æ¶ˆè¿½è¸ªã€ä¿®æ”¹ Rank

### æ•°æ®æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dashboard    â”‚
â”‚ æŒ‚è½½æ—¶       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SongList ç»„ä»¶    â”‚
â”‚ useEffect è·å–   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/songs/my-songs     â”‚
â”‚ - æŸ¥è¯¢ user_song_rel... â”‚
â”‚ - JOIN songs            â”‚
â”‚ - è·å–æœ€æ–°ç»Ÿè®¡          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éå†æ¸²æŸ“ SongCard       â”‚
â”‚ - æ˜¾ç¤ºæ­Œæ›²ä¿¡æ¯          â”‚
â”‚ - æ˜¾ç¤ºç»Ÿè®¡æ•°æ®          â”‚
â”‚ - æ“ä½œèœå•              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ–‡ä»¶

### **1. è·å–æ­Œæ›²åˆ—è¡¨ API**

**`src/app/api/songs/my-songs/route.ts`**

```jsx
export async function GET() {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    return NextResponse.json({ error: 'æœªç™»å½•' }, { status: 401 })
  }
  
  // 1. æŸ¥è¯¢ç”¨æˆ·å…³æ³¨çš„æ­Œæ›²ï¼ˆåˆ©ç”¨ RLS è‡ªåŠ¨è¿‡æ»¤ï¼‰
  const { data: relations } = await supabase
    .from('user_song_relations')
    .select(`
      id,
      created_at,
      song_id,
      songs (
        id,
        song_id,
        title,
        artist,
        album,
        cover_url,
        rank,
        created_at
      )
    `)
    .eq('user_id', user.id)
    .order('created_at', { ascending: false })
  
  // 2. æå–æ­Œæ›²æ•°æ®
  const songs = relations.map(r => r.songs).filter(Boolean)
  
  // 3. è·å–æ¯é¦–æ­Œçš„æœ€æ–°ç»Ÿè®¡
  const songsWithStats = await Promise.all(
    songs.map(async (song) => {
      const { data: latestStats } = await supabase
        .from('song_stats')
        .select('likes, favorites, comments, shares, fetched_at')
        .eq('song_id', song.id)
        .order('fetched_at', { ascending: false })
        .limit(1)
        .maybeSingle()
      
      return {
        ...song,
        latest_stats: latestStats || {
          likes: 0,
          favorites: 0,
          comments: 0,
          shares: 0,
          fetched_at: null,
        }
      }
    })
  )
  
  return NextResponse.json({
    songs: songsWithStats,
    total: songs.length,
  })
}
```

**SQL æŸ¥è¯¢è¯¦è§£**ï¼š

```jsx
// Supabase çš„ select æ”¯æŒåµŒå¥—æŸ¥è¯¢
.select(`
  id,
  created_at,
  song_id,
  songs (...)  // è‡ªåŠ¨ JOIN songs è¡¨
`)
```

ç­‰ä»·äº SQL:

```jsx
SELECT 
  r.id,
  r.created_at,
  r.song_id,
  s.*
FROM user_song_relations r
LEFT JOIN songs s ON r.song_id = s.id
WHERE r.user_id = $user_id
```

### **2. æ­Œæ›²å¡ç‰‡ç»„ä»¶**

**`src/components/songs/song-card.tsx`**

```jsx
'use client'

import { useState } from 'react'
import { Card } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { DropdownMenu } from '@/components/ui/dropdown-menu'
import { Music, MoreVertical } from 'lucide-react'
import { toast } from 'sonner'

interface SongCardProps {
  song: {
    id: string
    title: string
    artist: string
    rank: 'A' | 'B' | 'C'
    latest_stats?: {
      likes: number
      comments: number
      shares: number
      fetched_at: string
    }
  }
  onDeleted?: () => void
}

export function SongCard({ song, onDeleted }: SongCardProps) {
  const [showDeleteDialog, setShowDeleteDialog] = useState(false)
  const [showRankDialog, setShowRankDialog] = useState(false)
  
  // å–æ¶ˆè¿½è¸ª
  const handleDelete = async () => {
    try {
      const response = await fetch('/api/songs/untrack', {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ song_id: song.id }),
      })
      
      if (!response.ok) throw new Error('åˆ é™¤å¤±è´¥')
      
      toast.success('å–æ¶ˆè¿½è¸ªæˆåŠŸ')
      onDeleted?.()  // é€šçŸ¥çˆ¶ç»„ä»¶åˆ·æ–°
      
    } catch (error) {
      toast.error('æ“ä½œå¤±è´¥')
    }
  }
  
  // ä¿®æ”¹ Rank
  const handleUpdateRank = async (newRank: 'A' | 'B' | 'C') => {
    try {
      const response = await fetch('/api/songs/update-rank', {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ song_id: song.id, rank: newRank }),
      })
      
      if (!response.ok) throw new Error('æ›´æ–°å¤±è´¥')
      
      toast.success('æ›´æ–°æˆåŠŸ')
      onDeleted?.()  // åˆ·æ–°åˆ—è¡¨
      
    } catch (error) {
      toast.error('æ“ä½œå¤±è´¥')
    }
  }
  
  return (
    <>
      <Card>
        {/* æ­Œæ›²ä¿¡æ¯ */}
        <div className="flex items-center justify-between">
          <div>
            <h3>{song.title}</h3>
            <p>{song.artist}</p>
          </div>
          
          {/* Rank å¾½ç«  */}
          <Badge>{song.rank}</Badge>
          
          {/* æ“ä½œèœå• */}
          <DropdownMenu>
            <DropdownMenuTrigger>
              <MoreVertical />
            </DropdownMenuTrigger>
            <DropdownMenuContent>
              <DropdownMenuItem onClick={() => setShowRankDialog(true)}>
                ä¿®æ”¹ Rank
              </DropdownMenuItem>
              <DropdownMenuItem onClick={() => setShowDeleteDialog(true)}>
                å–æ¶ˆè¿½è¸ª
              </DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        </div>
        
        {/* ç»Ÿè®¡æ•°æ® */}
        <div className="grid grid-cols-3">
          <div>ç‚¹èµ: {song.latest_stats?.likes}</div>
          <div>è¯„è®º: {song.latest_stats?.comments}</div>
          <div>åˆ†äº«: {song.latest_stats?.shares}</div>
        </div>
      </Card>
      
      {/* ç¡®è®¤å¯¹è¯æ¡† */}
      <DeleteSongDialog
        open={showDeleteDialog}
        onOpenChange={setShowDeleteDialog}
        onConfirm={handleDelete}
        songTitle={song.title}
      />
      
      <UpdateRankDialog
        open={showRankDialog}
        onOpenChange={setShowRankDialog}
        onConfirm={handleUpdateRank}
        currentRank={song.rank}
      />
    </>
  )
}
```

**ç»„ä»¶è®¾è®¡è¦ç‚¹**ï¼š

- **çŠ¶æ€ç®¡ç†**ï¼šæ¯ä¸ªå¯¹è¯æ¡†ç‹¬ç«‹çŠ¶æ€
- **å›è°ƒé€šçŸ¥**ï¼šé€šè¿‡ `onDeleted` é€šçŸ¥çˆ¶ç»„ä»¶
- **Toast æç¤º**ï¼šæ“ä½œåé¦ˆ
- **å¯¹è¯æ¡†åˆ†ç¦»**ï¼š`DeleteSongDialog`ã€`UpdateRankDialog` ç‹¬ç«‹ç»„ä»¶

### **3. å–æ¶ˆè¿½è¸ª API**

**`src/app/api/songs/untrack/route.ts`**

```jsx
export async function DELETE(request: Request) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    return NextResponse.json({ error: 'æœªç™»å½•' }, { status: 401 })
  }
  
  const { song_id } = await request.json()
  
  // ä½¿ç”¨ admin å®¢æˆ·ç«¯åˆ é™¤å…³è”
  const supabaseAdmin = createAdminClient(...)
  
  await supabaseAdmin
    .from('user_song_relations')
    .delete()
    .eq('user_id', user.id)
    .eq('song_id', song_id)
  
  return NextResponse.json({ success: true })
}
```

**é€»è¾‘è¦ç‚¹**ï¼š

- åªåˆ é™¤ `user_song_relations` è®°å½•
- ä¸åˆ é™¤ `songs` è¡¨ï¼ˆå…¶ä»–ç”¨æˆ·å¯èƒ½è¿˜åœ¨è¿½è¸ªï¼‰
- çº§è”åˆ é™¤ç”±æ•°æ®åº“è‡ªåŠ¨å¤„ç†

### **4. ä¿®æ”¹ Rank API**

**`src/app/api/songs/update-rank/route.ts`**

```jsx
export async function PATCH(request: Request) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    return NextResponse.json({ error: 'æœªç™»å½•' }, { status: 401 })
  }
  
  const { song_id, rank } = await request.json()
  
  // éªŒè¯ Rank å€¼
  if (!['A', 'B', 'C'].includes(rank)) {
    return NextResponse.json({ error: 'æ— æ•ˆçš„ Rank' }, { status: 400 })
  }
  
  // éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™ï¼ˆæ˜¯è¿½è¸ªè€…æˆ–ç®¡ç†å‘˜ï¼‰
  const { data: relation } = await supabase
    .from('user_song_relations')
    .select('id')
    .eq('user_id', user.id)
    .eq('song_id', song_id)
    .maybeSingle()
  
  if (!relation) {
    return NextResponse.json({ error: 'æ— æƒé™' }, { status: 403 })
  }
  
  // æ›´æ–° Rank
  const supabaseAdmin = createAdminClient(...)
  
  await supabaseAdmin
    .from('songs')
    .update({ rank })
    .eq('id', song_id)
  
  return NextResponse.json({ success: true })
}
```

**æƒé™æ§åˆ¶**ï¼š
- éªŒè¯ç”¨æˆ·æ˜¯å¦è¿½è¸ªäº†è¯¥æ­Œæ›²
- ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹æ‰€æœ‰æ­Œæ›²
- ä½¿ç”¨ PATCH æ–¹æ³•ï¼ˆéƒ¨åˆ†æ›´æ–°ï¼‰

### æ£€æŸ¥ç‚¹
- [ ] Dashboard æ˜¾ç¤ºæ­Œæ›²åˆ—è¡¨
- [ ] ç‚¹å‡»"å–æ¶ˆè¿½è¸ª"ï¼Œæ­Œæ›²æ¶ˆå¤±
- [ ] ç‚¹å‡»"ä¿®æ”¹ Rank"ï¼ŒRank æ›´æ–°
- [ ] Toast æç¤ºæ­£å¸¸æ˜¾ç¤º

---

## é˜¶æ®µ 6ï¼šæ•°æ®æŠ“å–ç³»ç»Ÿï¼ˆSupabase Cronï¼‰

### ç›®æ ‡
ä½¿ç”¨ Supabase pg_cron å®šæ—¶æŠ“å–æ•°æ®

### Cron æ‰§è¡Œæµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase pg_cron         â”‚
â”‚ æ¯å°æ—¶è§¦å‘ï¼ˆRank Aï¼‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ trigger_fetch_rank_a()      â”‚
â”‚ PostgreSQL å‡½æ•°             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯»å–ç§æœ‰é…ç½®è¡¨              â”‚
â”‚ - supabase_url              â”‚
â”‚ - service_role_key          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒç”¨ Edge Function (å¯é€‰)   â”‚
â”‚ æˆ–ç›´æ¥åœ¨å‡½æ•°å†…æŠ“å–          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FOR EACH æ­Œæ›² IN Rank A     â”‚
â”‚ 1. è°ƒç”¨æŠ–éŸ³ API             â”‚
â”‚ 2. è§£ææ•°æ®                 â”‚
â”‚ 3. INSERT song_stats        â”‚
â”‚ 4. INSERT fetch_logs        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒé…ç½®

### **1. åˆ›å»ºç§æœ‰é…ç½®è¡¨**

```jsx
-- åˆ›å»º private schema
CREATE SCHEMA IF NOT EXISTS private;

-- é…ç½®è¡¨
CREATE TABLE IF NOT EXISTS private.app_config (
  key text PRIMARY KEY,
  value text NOT NULL
);

-- å†™å…¥é…ç½®
INSERT INTO private.app_config (key, value) VALUES
  ('supabase_url', 'https://your-project.supabase.co'),
  ('service_role_key', 'your_service_role_key')
ON CONFLICT (key) DO UPDATE SET value = EXCLUDED.value;
```

**ä¸ºä»€ä¹ˆéœ€è¦ç§æœ‰é…ç½®ï¼Ÿ**

- pg_cron è¿è¡Œåœ¨æ•°æ®åº“å†…éƒ¨
- éœ€è¦è®¿é—® Supabase URL å’Œ Key
- ä¸èƒ½ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆNode.js æ‰æœ‰ï¼‰
- private schema ä¸è¢« API æš´éœ²

### **2. åˆ›å»ºè§¦å‘å‡½æ•°**

```jsx
CREATE OR REPLACE FUNCTION trigger_fetch_rank_a()
RETURNS void AS $$
DECLARE
  _url text;
  _key text;
BEGIN
  -- è¯»å–é…ç½®
  SELECT value INTO _url FROM private.app_config WHERE key = 'supabase_url';
  SELECT value INTO _key FROM private.app_config WHERE key = 'service_role_key';
  
  -- è°ƒç”¨ Edge Function æˆ–ç›´æ¥åœ¨è¿™é‡Œå†™æŠ“å–é€»è¾‘
  -- æ–¹æ¡ˆ1: è°ƒç”¨ Edge Function
  PERFORM net.http_post(
    url := _url || '/functions/v1/fetch-rank-a',
    headers := jsonb_build_object(
      'Content-Type', 'application/json',
      'Authorization', 'Bearer ' || _key
    )
  );
  
  -- æ–¹æ¡ˆ2: ç›´æ¥åœ¨å‡½æ•°å†…æŠ“å–ï¼ˆæ›´ç®€å•ï¼‰
  -- è§ä¸‹æ–‡
END;
$$ LANGUAGE plpgsql;
```

3. åˆ›å»º Cron ä»»åŠ¡

```jsx
-- Rank A: æ¯å°æ—¶
SELECT cron.schedule(
  'fetch-rank-a-hourly',
  '0 * * * *',  -- Cron è¡¨è¾¾å¼ï¼šæ¯å°æ—¶çš„ç¬¬0åˆ†é’Ÿ
  $$SELECT trigger_fetch_rank_a()$$
);

-- Rank B: æ¯6å°æ—¶
SELECT cron.schedule(
  'fetch-rank-b-6hourly',
  '0 */6 * * *',
  $$SELECT trigger_fetch_rank_b()$$
);

-- Rank C: æ¯12å°æ—¶
SELECT cron.schedule(
  'fetch-rank-c-12hourly',
  '0 */12 * * *',
  $$SELECT trigger_fetch_rank_c()$$
);

-- æ¯æ—¥æ±‡æ€»: æ¯å¤© 00:00
SELECT cron.schedule(
  'daily-rollup',
  '0 0 * * *',
  $$SELECT trigger_daily_rollup()$$
);
```

**Cron è¡¨è¾¾å¼è¯´æ˜**ï¼š

```jsx
*    *    *    *    *
  â”‚    â”‚    â”‚    â”‚    â”‚
  â”‚    â”‚    â”‚    â”‚    â””â”€ æ˜ŸæœŸå‡  (0-6, 0=å‘¨æ—¥)
  â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€ æœˆä»½ (1-12)
  â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¥
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0-59)

#### **4. ç›´æ¥åœ¨ SQL å‡½æ•°å†…æŠ“å–ï¼ˆæ¨èï¼‰**
```sql
CREATE OR REPLACE FUNCTION fetch_and_save_rank_a()
RETURNS void AS $$
DECLARE
  song_record RECORD;
  api_response jsonb;
  likes_count bigint;
  comments_count bigint;
  shares_count bigint;
BEGIN
  -- éå† Rank A æ­Œæ›²
  FOR song_record IN 
    SELECT id, song_id, title FROM songs WHERE rank = 'A'
  LOOP
    BEGIN
      -- è°ƒç”¨ HTTP APIï¼ˆéœ€è¦ pg_net æ‰©å±•ï¼‰
      SELECT content::jsonb INTO api_response
      FROM net.http_get(
        'https://beta-luna.douyin.com/luna/h5/seo_track?track_id=' || song_record.song_id
      );
      
      -- è§£ææ•°æ®
      likes_count := (api_response->'seo_track'->'track'->'stats'->>'count_collected')::bigint;
      comments_count := (api_response->'seo_track'->'track'->'stats'->>'count_comment')::bigint;
      shares_count := (api_response->'seo_track'->'track'->'stats'->>'count_shared')::bigint;
      
      -- æ’å…¥ç»Ÿè®¡æ•°æ®
      INSERT INTO song_stats (song_id, likes, favorites, comments, shares)
      VALUES (song_record.id, likes_count, 0, comments_count, shares_count);
      
      -- è®°å½•æˆåŠŸæ—¥å¿—
      INSERT INTO fetch_logs (song_id, status)
      VALUES (song_record.id, 'success');
      
    EXCEPTION WHEN OTHERS THEN
      -- è®°å½•å¤±è´¥æ—¥å¿—
      INSERT INTO fetch_logs (song_id, status, error_message)
      VALUES (song_record.id, 'error', SQLERRM);
    END;
    
    -- å»¶è¿Ÿ1ç§’ï¼ˆé¿å…è¯·æ±‚è¿‡å¿«ï¼‰
    PERFORM pg_sleep(1);
  END LOOP;
END;
$$ LANGUAGE plpgsql;
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨ `pg_net` æ‰©å±•å‘é€ HTTP è¯·æ±‚
- `FOR LOOP` éå†æ­Œæ›²
- `TRY-CATCH` é”™è¯¯å¤„ç†
- `pg_sleep` é™æµ

### æŸ¥çœ‹å’Œç®¡ç† Cron
```sql
-- æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
SELECT * FROM cron.job;

-- æŸ¥çœ‹æ‰§è¡Œå†å²
SELECT * FROM cron.job_run_details
ORDER BY start_time DESC
LIMIT 10;

-- å–æ¶ˆä»»åŠ¡
SELECT cron.unschedule('fetch-rank-a-hourly');
```

### æ£€æŸ¥ç‚¹
- [ ] Cron ä»»åŠ¡åˆ›å»ºæˆåŠŸ
- [ ] æ‰‹åŠ¨æ‰§è¡Œå‡½æ•°ï¼Œæ•°æ®æ­£å¸¸æ’å…¥
- [ ] æŸ¥çœ‹ `fetch_logs` æœ‰è®°å½•
- [ ] `song_stats` è¡¨æœ‰æ–°æ•°æ®

---

## é˜¶æ®µ 7ï¼šæ•°æ®å¯è§†åŒ–

### ç›®æ ‡
å±•ç¤ºè¶‹åŠ¿å›¾è¡¨ã€æ¯æ—¥å¢é‡ã€ç»Ÿè®¡å¡ç‰‡

### å›¾è¡¨æ•°æ®æµç¨‹å›¾
```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯¦æƒ…é¡µæŒ‚è½½       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/songs/[id]          â”‚
â”‚ 1. è·å–æ­Œæ›²ä¿¡æ¯          â”‚
â”‚ 2. è·å–å†å²ç»Ÿè®¡æ•°æ®      â”‚
â”‚ 3. è·å–æ¯æ—¥å¢é‡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯å¤„ç†æ•°æ®             â”‚
â”‚ 1. è½¬æ¢ä¸ºå›¾è¡¨æ ¼å¼        â”‚
â”‚ 2. è®¡ç®—å¢é•¿ç‡            â”‚
â”‚ 3. æ¸²æŸ“å›¾è¡¨              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```jsx
### æ ¸å¿ƒæ–‡ä»¶

#### **1. è·å–è¯¦æƒ… API**

**`src/app/api/songs/[id]/route.ts`**
```typescript
export async function GET(
  request: Request,
  { params }: { params: Promise<{ id: string }> }
) {
  const { id } = await params
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    return NextResponse.json({ error: 'æœªç™»å½•' }, { status: 401 })
  }
  
  // 1. è·å–æ­Œæ›²ä¿¡æ¯
  const { data: song } = await supabase
    .from('songs')
    .select('*')
    .eq('id', id)
    .single()
  
  // 2. éªŒè¯æƒé™ï¼ˆæ˜¯å¦è¿½è¸ªäº†è¯¥æ­Œæ›²ï¼‰
  const { data: relation } = await supabase
    .from('user_song_relations')
    .select('id')
    .eq('user_id', user.id)
    .eq('song_id', id)
    .maybeSingle()
  
  if (!relation) {
    return NextResponse.json({ error: 'æ— æƒé™' }, { status: 403 })
  }
  
  // 3. è·å–æœ€è¿‘30å¤©çš„ç»Ÿè®¡æ•°æ®
  const thirtyDaysAgo = new Date()
  thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30)
  
  const { data: stats } = await supabase
    .from('song_stats')
    .select('*')
    .eq('song_id', id)
    .gte('fetched_at', thirtyDaysAgo.toISOString())
    .order('fetched_at', { ascending: true })
  
  // 4. è·å–æ¯æ—¥å¢é‡
  const { data: dailyStats } = await supabase
    .from('daily_stats')
    .select('*')
    .eq('song_id', id)
    .gte('date', thirtyDaysAgo.toISOString().split('T')[0])
    .order('date', { ascending: true })
  
  return NextResponse.json({
    song,
    stats: stats || [],
    dailyStats: dailyStats || [],
  })
}
```

**SQL ä¼˜åŒ–**ï¼š
- ä½¿ç”¨ `gte` (>=) è¿‡æ»¤æ—¶é—´
- `order by` æ’åº
- åˆ©ç”¨ç´¢å¼• `idx_song_stats_song_fetched`

#### **2. è¶‹åŠ¿å›¾è¡¨ç»„ä»¶**

**`src/components/charts/stats-chart.tsx`**
```typescript
'use client'

import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts'
import { formatCount } from '@/lib/parse-douyin-data'

interface StatsChartProps {
  data: Array<{
    fetched_at: string
    likes: number
    comments: number
    shares: number
  }>
}

export function StatsChart({ data }: StatsChartProps) {
  // è½¬æ¢æ•°æ®æ ¼å¼
  const chartData = data.map(item => ({
    time: new Date(item.fetched_at).toLocaleDateString('zh-CN', {
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
    }),
    ç‚¹èµ: item.likes,
    è¯„è®º: item.comments,
    åˆ†äº«: item.shares,
  }))
  
  return (
    <ResponsiveContainer width="100%" height={400}>
      <LineChart data={chartData}>
        <CartesianGrid strokeDasharray="3 3" />
        <XAxis 
          dataKey="time"
          angle={-45}
          textAnchor="end"
        />
        <YAxis tickFormatter={formatCount} />
        <Tooltip formatter={(value: number) => value.toLocaleString()} />
        <Legend />
        <Line 
          type="monotone" 
          dataKey="ç‚¹èµ" 
          stroke="#ef4444"
          strokeWidth={2}
        />
        <Line 
          type="monotone" 
          dataKey="è¯„è®º" 
          stroke="#22c55e"
          strokeWidth={2}
        />
        <Line 
          type="monotone" 
          dataKey="åˆ†äº«" 
          stroke="#a855f7"
          strokeWidth={2}
        />
      </LineChart>
    </ResponsiveContainer>
  )
}
```

**Recharts å…³é”®å±æ€§**ï¼š
- `ResponsiveContainer`: è‡ªé€‚åº”å®¹å™¨
- `type="monotone"`: å¹³æ»‘æ›²çº¿
- `strokeWidth`: çº¿æ¡ç²—ç»†
- `tickFormatter`: Y è½´æ ¼å¼åŒ–ï¼ˆ1000 â†’ 1Kï¼‰

#### **3. æ¯æ—¥å¢é‡æŸ±çŠ¶å›¾**

**`src/components/charts/daily-stats-chart.tsx`**
```typescript
import { BarChart, Bar, XAxis, YAxis, Tooltip, Legend, ResponsiveContainer } from 'recharts'

interface DailyStatsChartProps {
  data: Array<{
    date: string
    likes: number
    comments: number
    shares: number
  }>
}

export function DailyStatsChart({ data }: DailyStatsChartProps) {
  const chartData = data.map(item => ({
    date: new Date(item.date).toLocaleDateString('zh-CN', {
      month: '2-digit',
      day: '2-digit',
    }),
    ç‚¹èµå¢é‡: item.likes,
    è¯„è®ºå¢é‡: item.comments,
    åˆ†äº«å¢é‡: item.shares,
  }))
  
  return (
    <ResponsiveContainer width="100%" height={400}>
      <BarChart data={chartData}>
        <CartesianGrid strokeDasharray="3 3" />
        <XAxis dataKey="date" />
        <YAxis />
        <Tooltip />
        <Legend />
        <Bar dataKey="ç‚¹èµå¢é‡" fill="#ef4444" />
        <Bar dataKey="è¯„è®ºå¢é‡" fill="#22c55e" />
        <Bar dataKey="åˆ†äº«å¢é‡" fill="#a855f7" />
      </BarChart>
    </ResponsiveContainer>
  )
}
```

#### **4. ç»Ÿè®¡å¡ç‰‡**

**`src/components/charts/stat-cards.tsx`**
```typescript
interface StatCardsProps {
  currentStats: {
    likes: number
    comments: number
    shares: number
  }
  previousStats?: {
    likes: number
    comments: number
    shares: number
  }
}

export function StatCards({ currentStats, previousStats }: StatCardsProps) {
  // è®¡ç®—å¢é•¿
  const calculateChange = (current: number, previous?: number) => {
    if (!previous) return null
    const change = current - previous
    const percentage = ((change / previous) * 100).toFixed(1)
    return { change, percentage }
  }
  
  const stats = [
    {
      title: 'ç‚¹èµæ•°',
      value: currentStats.likes,
      icon: Heart,
      change: calculateChange(currentStats.likes, previousStats?.likes),
    },
    // ... å…¶ä»–ç»Ÿè®¡
  ]
  
  return (
    <div className="grid grid-cols-4 gap-4">
      {stats.map(stat => (
        <Card key={stat.title}>
          <CardHeader>
            <CardTitle>{stat.title}</CardTitle>
            <stat.icon />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              {formatCount(stat.value)}
            </div>
            {stat.change && (
              <div className={stat.change.change > 0 ? 'text-green-600' : 'text-red-600'}>
                {stat.change.change > 0 ? 'â†‘' : 'â†“'} {stat.change.percentage}%
              </div>
            )}
          </CardContent>
        </Card>
      ))}
    </div>
  )
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- æ˜¾ç¤ºå½“å‰å€¼
- æ˜¾ç¤ºå¢é•¿ç‡
- é¢œè‰²åŒºåˆ†å¢é•¿/ä¸‹é™
- å›¾æ ‡å¢å¼ºè§†è§‰

### æ£€æŸ¥ç‚¹
- [ ] è¯¦æƒ…é¡µæ˜¾ç¤ºå›¾è¡¨
- [ ] è¶‹åŠ¿å›¾æ­£å¸¸æ¸²æŸ“
- [ ] æ¯æ—¥å¢é‡æŸ±çŠ¶å›¾æ˜¾ç¤º
- [ ] ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºå¢é•¿ç‡

---

## é˜¶æ®µ 8ï¼šæ¯æ—¥å¢é‡è®¡ç®—

### ç›®æ ‡
æ¯å¤©è‡ªåŠ¨è®¡ç®—æ•°æ®å¢é‡

### è®¡ç®—é€»è¾‘å›¾
```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯å¤© 00:00 è§¦å‘      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FOR EACH æ­Œæ›²                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·å–ä»Šå¤©æœ€åä¸€æ¡ç»Ÿè®¡         â”‚
â”‚ SELECT * FROM song_stats     â”‚
â”‚ WHERE date = today           â”‚
â”‚ ORDER BY fetched_at DESC     â”‚
â”‚ LIMIT 1                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·å–æ˜¨å¤©æœ€åä¸€æ¡ç»Ÿè®¡         â”‚
â”‚ SELECT * FROM song_stats     â”‚
â”‚ WHERE date = yesterday       â”‚
â”‚ ORDER BY fetched_at DESC     â”‚
â”‚ LIMIT 1                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¡ç®—å¢é‡                     â”‚
â”‚ likes_inc = today - yesterdayâ”‚
â”‚ change_rate = inc / yesterdayâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSERT INTO daily_stats      â”‚
â”‚ (song_id, date, likes, ...)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```jsx
### æ ¸å¿ƒ SQL å‡½æ•°
```sql
CREATE OR REPLACE FUNCTION trigger_daily_rollup()
RETURNS void AS $$
DECLARE
  song_record RECORD;
  today_stats RECORD;
  yesterday_stats RECORD;
  today_date DATE := CURRENT_DATE;
  yesterday_date DATE := CURRENT_DATE - INTERVAL '1 day';
  likes_inc BIGINT;
  comments_inc BIGINT;
  shares_inc BIGINT;
  change_rate_val FLOAT;
BEGIN
  -- éå†æ‰€æœ‰æ­Œæ›²
  FOR song_record IN SELECT id, title FROM songs
  LOOP
    BEGIN
      -- åˆ é™¤ä»Šå¤©çš„æ—§è®°å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      DELETE FROM daily_stats 
      WHERE song_id = song_record.id AND date = today_date;
      
      -- è·å–ä»Šå¤©çš„æœ€æ–°æ•°æ®
      SELECT likes, comments, shares 
      INTO today_stats
      FROM song_stats
      WHERE song_id = song_record.id
        AND fetched_at >= today_date::timestamp
        AND fetched_at < (today_date + INTERVAL '1 day')::timestamp
      ORDER BY fetched_at DESC
      LIMIT 1;
      
      -- å¦‚æœä»Šå¤©æ²¡æœ‰æ•°æ®ï¼Œè·³è¿‡
      CONTINUE WHEN NOT FOUND;
      
      -- è·å–æ˜¨å¤©çš„æœ€æ–°æ•°æ®
      SELECT likes, comments, shares 
      INTO yesterday_stats
      FROM song_stats
      WHERE song_id = song_record.id
        AND fetched_at >= yesterday_date::timestamp
        AND fetched_at < today_date::timestamp
      ORDER BY fetched_at DESC
      LIMIT 1;
      
      -- è®¡ç®—å¢é‡
      likes_inc := today_stats.likes - COALESCE(yesterday_stats.likes, 0);
      comments_inc := today_stats.comments - COALESCE(yesterday_stats.comments, 0);
      shares_inc := today_stats.shares - COALESCE(yesterday_stats.shares, 0);
      
      -- è®¡ç®—å˜åŒ–ç‡
      IF yesterday_stats.likes > 0 THEN
        change_rate_val := (likes_inc::FLOAT / yesterday_stats.likes) * 100;
      ELSE
        change_rate_val := 0;
      END IF;
      
      -- æ’å…¥æ¯æ—¥ç»Ÿè®¡
      INSERT INTO daily_stats (song_id, date, likes, comments, shares, change_rate)
      VALUES (song_record.id, today_date, likes_inc, comments_inc, shares_inc, change_rate_val);
      
    EXCEPTION WHEN OTHERS THEN
      -- è®°å½•é”™è¯¯ä½†ç»§ç»­å¤„ç†ä¸‹ä¸€é¦–æ­Œ
      RAISE NOTICE 'Error processing song %: %', song_record.title, SQLERRM;
    END;
  END LOOP;
END;
$$ LANGUAGE plpgsql;
```

**å…³é”®SQLçŸ¥è¯†**ï¼š
- `COALESCE(value, default)`: å¦‚æœå€¼ä¸º NULLï¼Œè¿”å›é»˜è®¤å€¼
- `CONTINUE WHEN`: è·³è¿‡å½“å‰å¾ªç¯
- `::timestamp`: ç±»å‹è½¬æ¢
- `RAISE NOTICE`: è¾“å‡ºæ—¥å¿—

### æ‰‹åŠ¨è§¦å‘ API

**`src/app/api/admin/trigger-daily-rollup/route.ts`**
```typescript
export async function POST(request: Request) {
  // ... éªŒè¯ç®¡ç†å‘˜æƒé™ ...
  
  const supabaseAdmin = createAdminClient(...)
  
  const today = new Date().toISOString().split('T')[0]
  const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000)
    .toISOString().split('T')[0]
  
  const { data: songs } = await supabaseAdmin
    .from('songs')
    .select('id, title')
  
  const results = {
    total: songs.length,
    success: 0,
    failed: 0,
    skipped: 0,
  }
  
  for (const song of songs) {
    try {
      // åˆ é™¤æ—§è®°å½•
      await supabaseAdmin
        .from('daily_stats')
        .delete()
        .eq('song_id', song.id)
        .eq('date', today)
      
      // è·å–ä»Šå¤©æ•°æ®
      const { data: todayData } = await supabaseAdmin
        .from('song_stats')
        .select('likes, comments, shares')
        .eq('song_id', song.id)
        .gte('fetched_at', `${today}T00:00:00Z`)
        .lte('fetched_at', `${today}T23:59:59Z`)
        .order('fetched_at', { ascending: false })
        .limit(1)
        .maybeSingle()
      
      if (!todayData) {
        results.skipped++
        continue
      }
      
      // è·å–æ˜¨å¤©æ•°æ®
      const { data: yesterdayData } = await supabaseAdmin
        .from('song_stats')
        .select('likes, comments, shares')
        .eq('song_id', song.id)
        .gte('fetched_at', `${yesterday}T00:00:00Z`)
        .lte('fetched_at', `${yesterday}T23:59:59Z`)
        .order('fetched_at', { ascending: false })
        .limit(1)
        .maybeSingle()
      
      // è®¡ç®—å¢é‡
      const likesInc = todayData.likes - (yesterdayData?.likes || 0)
      const commentsInc = todayData.comments - (yesterdayData?.comments || 0)
      const sharesInc = todayData.shares - (yesterdayData?.shares || 0)
      
      const changeRate = yesterdayData?.likes
        ? ((likesInc / yesterdayData.likes) * 100)
        : 0
      
      // æ’å…¥
      await supabaseAdmin
        .from('daily_stats')
        .insert({
          song_id: song.id,
          date: today,
          likes: likesInc,
          comments: commentsInc,
          shares: sharesInc,
          change_rate: changeRate,
        })
      
      results.success++
      
    } catch (error) {
      results.failed++
    }
  }
  
  return NextResponse.json({
    success: true,
    results,
  })
}
```

### æ£€æŸ¥ç‚¹
- [ ] æ‰‹åŠ¨è§¦å‘æ¯æ—¥æ±‡æ€»
- [ ] `daily_stats` è¡¨æœ‰æ–°è®°å½•
- [ ] å¢é‡å€¼æ­£ç¡®
- [ ] è¯¦æƒ…é¡µæ˜¾ç¤ºæ¯æ—¥å¢é‡å›¾

---

## é˜¶æ®µ 9ï¼šç®¡ç†åå°

### ç›®æ ‡
ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ã€æ‰€æœ‰æ­Œæ›²ã€æ‰‹åŠ¨è§¦å‘æŠ“å–

### æƒé™æ£€æŸ¥æµç¨‹
```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¿é—® /admin  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useAuthStore     â”‚
â”‚ æ£€æŸ¥ isAdmin     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”œâ”€ false â†’ è·³è½¬ /dashboard
â”‚
â””â”€ true
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¸²æŸ“ç®¡ç†åå°       â”‚
â”‚ - ç”¨æˆ·åˆ—è¡¨         â”‚
â”‚ - æ­Œæ›²åˆ—è¡¨         â”‚
â”‚ - è§¦å‘æŠ“å–         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```jsx
### æ ¸å¿ƒæ–‡ä»¶

#### **1. ç”¨æˆ·åˆ—è¡¨ API**

**`src/app/api/admin/users/route.ts`**
```typescript
export async function GET() {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  // éªŒè¯ç®¡ç†å‘˜æƒé™
  const { data: adminData } = await supabase
    .from('admins')
    .select('role')
    .eq('user_id', user.id)
    .maybeSingle()
  
  if (!adminData) {
    return NextResponse.json({ error: 'æ— æƒé™' }, { status: 403 })
  }
  
  // ä½¿ç”¨ admin å®¢æˆ·ç«¯è·å–æ‰€æœ‰ç”¨æˆ·
  const supabaseAdmin = createAdminClient(...)
  
  const { data: users } = await supabaseAdmin.auth.admin.listUsers()
  
  // è·å–æ¯ä¸ªç”¨æˆ·çš„æ­Œæ›²æ•°é‡
  const usersWithStats = await Promise.all(
    users.users.map(async (u) => {
      const { count } = await supabaseAdmin
        .from('user_song_relations')
        .select('*', { count: 'exact', head: true })
        .eq('user_id', u.id)
      
      const { data: adminInfo } = await supabaseAdmin
        .from('admins')
        .select('role')
        .eq('user_id', u.id)
        .maybeSingle()
      
      return {
        id: u.id,
        email: u.email,
        created_at: u.created_at,
        song_count: count || 0,
        is_admin: !!adminInfo,
        admin_role: adminInfo?.role,
      }
    })
  )
  
  return NextResponse.json({
    users: usersWithStats,
    total: users.users.length,
  })
}
```

**å…³é”®API**ï¼š
- `supabaseAdmin.auth.admin.listUsers()`: è·å–æ‰€æœ‰ç”¨æˆ·
- `select('*', { count: 'exact', head: true })`: åªè¿”å›æ•°é‡
- `Promise.all()`: å¹¶å‘æŸ¥è¯¢å¤šä¸ªç”¨æˆ·

#### **2. å…¨å±€æ­Œæ›²åˆ—è¡¨ API**

**`src/app/api/admin/all-songs/route.ts`**
```typescript
export async function GET() {
  // ... éªŒè¯ç®¡ç†å‘˜æƒé™ ...
  
  const { data: songs } = await supabaseAdmin
    .from('songs')
    .select('*')
    .order('created_at', { ascending: false })
  
  // è·å–æ¯é¦–æ­Œçš„è¿½è¸ªç”¨æˆ·æ•°
  const songsWithStats = await Promise.all(
    songs.map(async (song) => {
      const { count: userCount } = await supabaseAdmin
        .from('user_song_relations')
        .select('*', { count: 'exact', head: true })
        .eq('song_id', song.id)
      
      const { data: latestStats } = await supabaseAdmin
        .from('song_stats')
        .select('likes, comments, shares, fetched_at')
        .eq('song_id', song.id)
        .order('fetched_at', { ascending: false })
        .limit(1)
        .maybeSingle()
      
      return {
        ...song,
        user_count: userCount || 0,
        latest_stats: latestStats,
      }
    })
  )
  
  return NextResponse.json({
    songs: songsWithStats,
    total: songs.length,
  })
}
```

#### **3. ç®¡ç†åå°é¡µé¢**

**`src/app/admin/page.tsx`**
```typescript
'use client'

export default function AdminPage() {
  const { user, isAdmin, isLoading } = useAuthStore()
  const router = useRouter()
  const [users, setUsers] = useState([])
  const [songs, setSongs] = useState([])
  
  // æƒé™æ£€æŸ¥
  useEffect(() => {
    if (!isLoading && (!user || !isAdmin)) {
      router.push('/dashboard')
    }
  }, [user, isAdmin, isLoading])
  
  // è·å–æ•°æ®
  useEffect(() => {
    if (isAdmin) {
      fetchUsers()
      fetchSongs()
    }
  }, [isAdmin])
  
  const fetchUsers = async () => {
    const response = await fetch('/api/admin/users')
    const data = await response.json()
    setUsers(data.users)
  }
  
  const fetchSongs = async () => {
    const response = await fetch('/api/admin/all-songs')
    const data = await response.json()
    setSongs(data.songs)
  }
  
  if (!isAdmin) return null
  
  return (
    <div>
      <h1>ç®¡ç†åå°</h1>
      
      {/* ç»Ÿè®¡å¡ç‰‡ */}
      <div className="grid grid-cols-3 gap-4">
        <Card>
          <CardTitle>æ€»ç”¨æˆ·æ•°</CardTitle>
          <div className="text-2xl">{users.length}</div>
        </Card>
        <Card>
          <CardTitle>æ€»æ­Œæ›²æ•°</CardTitle>
          <div className="text-2xl">{songs.length}</div>
        </Card>
        <Card>
          <CardTitle>å¹³å‡è¿½è¸ª</CardTitle>
          <div className="text-2xl">
            {(users.reduce((sum, u) => sum + u.song_count, 0) / users.length).toFixed(1)}
          </div>
        </Card>
      </div>
      
      {/* æ•°æ®æŠ“å–æ§åˆ¶ */}
      <TriggerFetch />
      
      {/* æ•°æ®è¡¨æ ¼ */}
      <Tabs>
        <TabsList>
          <TabsTrigger value="users">ç”¨æˆ·ç®¡ç†</TabsTrigger>
          <TabsTrigger value="songs">æ­Œæ›²ç®¡ç†</TabsTrigger>
        </TabsList>
        
        <TabsContent value="users">
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead>é‚®ç®±</TableHead>
                <TableHead>è§’è‰²</TableHead>
                <TableHead>è¿½è¸ªæ­Œæ›²</TableHead>
                <TableHead>æ³¨å†Œæ—¶é—´</TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {users.map(u => (
                <TableRow key={u.id}>
                  <TableCell>{u.email}</TableCell>
                  <TableCell>
                    {u.is_admin ? <Badge>ç®¡ç†å‘˜</Badge> : 'æ™®é€šç”¨æˆ·'}
                  </TableCell>
                  <TableCell>{u.song_count} é¦–</TableCell>
                  <TableCell>
                    {new Date(u.created_at).toLocaleDateString()}
                  </TableCell>
                </TableRow>
              ))}
            </TableBody>
          </Table>
        </TabsContent>
        
        <TabsContent value="songs">
          {/* æ­Œæ›²è¡¨æ ¼ç±»ä¼¼ */}
        </TabsContent>
      </Tabs>
    </div>
  )
}
```

### æ£€æŸ¥ç‚¹
- [ ] ç®¡ç†å‘˜å¯ä»¥è®¿é—® `/admin`
- [ ] æ™®é€šç”¨æˆ·è®¿é—® `/admin` è¢«è·³è½¬
- [ ] æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨
- [ ] æ˜¾ç¤ºæ­Œæ›²åˆ—è¡¨
- [ ] æ‰‹åŠ¨è§¦å‘æŠ“å–æ­£å¸¸

---

## é˜¶æ®µ 10ï¼šéƒ¨ç½²åˆ° Vercel

### ç›®æ ‡
éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### éƒ¨ç½²æµç¨‹å›¾
```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨é€ä»£ç åˆ°   â”‚
â”‚ GitHub       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel è‡ªåŠ¨æ£€æµ‹  â”‚
â”‚ - æ‹‰å–ä»£ç        â”‚
â”‚ - npm install    â”‚
â”‚ - npm run build  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éƒ¨ç½²åˆ°å…¨çƒ CDN   â”‚
â”‚ - é™æ€æ–‡ä»¶       â”‚
â”‚ - API Routes     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¿é—®ç”Ÿäº§ç¯å¢ƒ     â”‚
â”‚ https://...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
SUPABASE_SERVICE_ROLE_KEY=...
NEXT_PUBLIC_DOUYIN_API_BASE=...
CRON_SECRET=...
NODE_VERSION=18